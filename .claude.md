# Claude Code Configuration

## Project Overview
This is a pharmacy report validation application for Turkish pharmacists. The app uses Playwright to navigate the https://medeczane.sgk.gov.tr/eczane website since no APIs are available for pharmacists in Turkey.

## Application Flow
1. **Landing Page** (`/`) - Shows loading spinner, automatically navigates to login after 2 seconds
2. **Login Page** (`/login`) - User enters SGK credentials, saves to localStorage, redirects to home
3. **Home Page** (`/home`) - Main dashboard with sidebar navigation and summary cards
4. **Prescription Search** (`/recete-arama`) - Search prescriptions on SGK portal with automated login and captcha solving

## Authentication
- Credentials are stored in localStorage as JSON: `{username, password, loginTime}`
- Home page checks for valid credentials, redirects to login if missing
- Logout clears localStorage and returns to landing page

## Development Commands

### Development
```bash
npm run start          # Start Electron app in development mode
```

### Testing
```bash
npm run test           # Run unit tests
npm run test:watch     # Run unit tests in watch mode
npm run test:e2e       # Run end-to-end tests with Playwright
npm run test:all       # Run all tests
```

### Code Quality
```bash
npm run lint           # Run ESLint
npm run format         # Check code formatting
npm run format:write   # Fix code formatting
```

### Build & Package
```bash
npm run package        # Package the app
npm run make          # Create distribution packages
npm run publish       # Publish the app
```

## Technology Stack
- **Framework**: Electron with Vite + TypeScript
- **UI**: React + shadcn/ui components
- **Router**: TanStack Router
- **Styling**: Tailwind CSS
- **Testing**: Vitest (unit), Playwright (e2e)
- **Automation**: Playwright for website navigation (isolated in child process)
- **HTTP Client**: node-fetch for captcha API calls
- **Internationalization**: i18next

## Known Issues & Solutions

### âœ… RESOLVED: Playwright-Electron Compatibility
**Issue**: `chromium-bidi/lib/cjs/bidiMapper/BidiMapper` module resolution error when importing Playwright in Electron main process.

**Solution**: Isolated Playwright in separate Node.js child process:
- Worker process handles all browser automation
- IPC communication between main process and worker
- No direct Playwright imports in Electron context
- Proper error handling and timeout management

## Playwright Automation Architecture

### Process Isolation Design
Due to Electron-Playwright compatibility issues (chromium-bidi module resolution errors), we use a separate Node.js process for all Playwright operations:

- **`src/services/playwright-worker.js`** - Standalone Node.js process containing all Playwright logic
- **`src/services/playwright-process-manager.ts`** - Manager class that spawns and communicates with worker process
- **`src/ipc/playwright/handlers.ts`** - IPC handlers that route Playwright commands to process manager

### SGK Portal Automation Features
- **Automatic Login**: Handles SGK portal login with username/password
- **Captcha Solving**: Integrates with localhost:3000/medula/numbers API for image recognition
- **Prescription Search**: Automated form filling and result extraction
- **Debug Mode**: Toggle for headless/headful browser operation via sidebar switch

### Workflow
1. Main portal navigation: `https://medeczane.sgk.gov.tr/eczane`
2. Search page: `https://medeczane.sgk.gov.tr/eczane/faces/index.jsp`
3. Automatic credential retrieval from localStorage
4. CAPTCHA handling with external API
5. Form submission and result parsing

## Key Directories
- `src/routes/` - Application routes
- `src/components/` - React components including shadcn/ui
- `src/services/` - Playwright automation services (worker + manager)
- `src/ipc/` - Inter-process communication handlers
- `src/layouts/` - Shared layout components with sidebar navigation
- `src/hooks/` - React hooks for Playwright state management